name: Publicar dataset no dados.mg (CKAN)

on:
  workflow_dispatch:
  push:
    branches: [main]
    paths:
      - "datapackage/**"
      - "scripts/**"

jobs:
  publish_ckan:
    runs-on: ubuntu-22.04

    steps:
      # 1ï¸âƒ£ Checkout
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4

      # 2ï¸âƒ£ Python
      - name: ğŸ Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      # 3ï¸âƒ£ Instalar dependÃªncias
      - name: ğŸ“¦ Instalar dpckan
        run: |
          python -m pip install --upgrade pip
          pip install dpckan frictionless requests

      # 4ï¸âƒ£ Publicar no CKAN
      - name: ğŸš€ Publicar dataset no dados.mg
        env:
          CKAN_HOST: ${{ secrets.CKAN_HOST }}
          CKAN_KEY: ${{ secrets.CKAN_KEY }}
        run: |
          dpckan dataset create \
            --datapackage datapackage/datapackage.json \
            --ckan-host "$CKAN_HOST" \
            --ckan-key "$CKAN_KEY"
